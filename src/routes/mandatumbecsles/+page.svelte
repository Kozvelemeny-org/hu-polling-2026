<script lang="ts">
    import type { PollData } from "$lib/types";
    import { onMount } from "svelte";
    import { pollData, fetchPollData } from "../../stores/dataStore";
    import PartyMandateProjection from "../../components/PartyMandateProjection.svelte";
    import MandateProjectionAside from "../../components/MandateProjectionAside.svelte";
    import OevkMap from "../../components/OEVKMap.svelte";
    import ParliamentChart from "../../components/ParliamentChart.svelte";

    let data: Record<'sure_voters' | 'all_voters', PollData> = {
        sure_voters: [],
        all_voters: [],
    };

    let aside: HTMLElement;

    function keepAsidePosition() {
        const headerHeight = 160 + 55;

        if (window.scrollY > headerHeight + 16 && window.innerWidth > 600) {
            aside.style.position = "fixed";
            aside.style.top = "16px";
            aside.style.width = "250px";
        } else {
            aside.style.position = "static";
            aside.style.width = "auto";
        }
    }

    onMount(() => {
        fetchPollData();
        window.addEventListener("scroll", keepAsidePosition);
    });

    $: data = $pollData;
</script>

<aside bind:this={aside}>
    <MandateProjectionAside />
</aside>
<main>
    <section class="parliamentChart">
        <div class="textBlock">
            <h2>A legvalószínűbb parlament</h2>
        </div>
        <ParliamentChart />
    </section>
    <section class="partyProjections">
        <div class="textBlock">
            <h2>Várható mandátumok pártonként</h2>
        </div>
        <article>
            <h3>Tisza</h3>
            <p>x százalék a közvélemény-kutatásokban</p>
        </article>
        <PartyMandateProjection
            party="tisza"
            data={[
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.03,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.02,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,
            ]} 
            median={101}
        />
        <div class="divider"></div>
        <article>
            <h3>Fidesz</h3>
            <p>x százalék a közvélemény-kutatásokban</p>
        </article>
        <PartyMandateProjection
            party="fidesz"
            data={[
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0.02,0.02,0.02,0.02,0.03,0.03,0.03,0.03,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.04,0.03,0.03,0.03,0.03,0.02,0.02,0.02,0.02,0.01,0.01,0.01,0.01,0.01,0.01,0.01,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0
            ]} 
            median={83}
        />
        <div class="divider"></div>
        <article>
            <h3>DK-MSZP-P</h3>
            <p>x százalék a közvélemény-kutatásokban</p>
        </article>
        <PartyMandateProjection
            party="dk_mszp_p"
            data={[
                0,0.0265,0.0302,0.034,0.0376,0.041,0.044,0.0465,0.0483,0.0495,0.0499,0.0495,0.0483,0.0465,0.044,0.041,0.0376,0.034,0.0302,0.0265,0.0228,0.0194,0.0162,0.0133,0.0108,0.0086,0.0067,0.0052,0.004,0.003,0.0022,0.0016,0.0011,0.0008,0.0006,0.0004,0.0003,0.0002,0.0001,0.0001,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
            ]} 
            median={9}
        />
        <div class="divider"></div>
        <article>
            <h3>Mi Hazánk</h3>
            <p>x százalék a közvélemény-kutatásokban</p>
        </article>
        <PartyMandateProjection
            party="mihazank"
            data={[
                0,0.0388,0.0484,0.0579,0.0666,0.0737,0.0782,0.0798,0.0782,0.0737,0.0666,0.0579,0.0484,0.0388,0.0299,0.0222,0.0158,0.0108,0.0071,0.0045,0.0027,0.0016,0.0009,0.0005,0.0002,0.0001,0.0001,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0
            ]} 
            median={6}
        />
        <div class="divider"></div>
        <article>
            <h3>MKKP</h3>
            <p>x százalék a közvélemény-kutatásokban</p>
        </article>
        <PartyMandateProjection
            party="mkkp"
            data={[
                0.0798, 0.0782, 0.0737, 0.0666, 0.0579, 0.0484, 0.0388, 0.0299, 0.0222, 0.0158, 0.0108, 0.0071, 0.0045, 0.0027, 0.0016, 0.0009, 0.0005, 0.0002, 0.0001, 0.0001, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
            ]} 
            median={0}
        />
    </section>
    <section class="map">
        <h2>Választókerületek legvalószínűbb eredménye</h2>
        <p>Országos mandátumok várható eloszlása a közvélemény-kutatások alapján.</p>
        <OevkMap />
    </section>
</main>


<style lang="scss">
    main {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    section {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        padding: 8px 1rem;
        background-color: #fcfcfc;
        border: 1px solid #eee;
        
        &.partyProjections {
            display: grid;
            grid-template-columns: 150px 1fr;
        }

        h2 {
            font-size: 26px;
            font-weight: 500;
        }

        h3 {
            font-size: 20px;
            font-weight: 400;
        }

        .textBlock {
            grid-column: 1 / 3;
        }

        .divider {
            grid-column: 1 / 3;
            border-top: 2px solid #eee;
            margin: 1rem 0;
        }
    }

    @media (min-width: 600px) {
        main {
            grid-column: 2 / 3;
        }
    }
    
    @media (min-width: 800px) {
        aside {
            grid-column: 1 / 2;
        }
        
        main {
            grid-column: 2 / 5;
        }
    }
</style>
